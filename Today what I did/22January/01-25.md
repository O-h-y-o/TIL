# 항해99 13주차 - 실전프로젝트 DAY-37

우리의 프로젝트 홈페이지가 대체적으로 느리다는 평이 많았다.
첫번째 원인으로 netlify의 속도가 느린것인가 생각이 들어 s3버킷에 프로젝트를 업로드하고 속도를 비교해보았다. netlify에 올렸을때보다 더 빠르다고 해주신다.

그동안 잘 써왔던 netlify를 버리고 s3로 갈아탔다.
그럼 github actions로 ci/cd 자동화를 해주어야 하는데 처음해보는거라 설정해줄게 너무나도 많았다.
오늘 하루종일 깃허브 액션하는 것만 한거같다..
설정해야할게 많아서 그렇지 안되는 것들도 몇번 고쳐주면 금방금방 잘 됐었다. 다만 한번 고치려는데 시간이 많이 걸릴 뿐이지..

그런데 문제는 깃허브에 푸쉬했을때, s3버킷에 자동으로 빌드하여 업로드하는 것 까지는 됐다. 근데 cloudfront가 얘를 제대로 못가져가나? 업데이트가 안되는 현상이 발생했다..!!! 원인을 찾는데에도 시간이 쪼오끔 걸렸다..

원인은 cloudfront는 설정된 s3 버킷의 주소를 바라보며 캐시가 비었을때 s3버킷에서 캐시를 가져와서 저장하고있는다. 근데 이게 24시간동안 저장되는거라 업데이트를 해주려면 무효화(invalidate)를 해주어야만 했다. 그런데 이걸 일일히 해줘야 하나 생각도 들었고, 당연히 자동화하는 방법도 있을거라 생각했다.

그래서 .yml파일에 (아주 많은 시행착오를 거치고)

```
- name: Invalidate Cache CloudFront
        uses: chetan/invalidate-cloudfront-action@master
        env:
          DISTRIBUTION: ${{secrets.DEV_DISTRIBUTION_ID}}
          PATHS: "/index.html"
        continue-on-error: true
```

를 추가했더니 결국은 해냈다..! 빌드가 되고, 무효화도 자동으로 잘 돼서 서버에 바로바로 업데이트가 되었다. 하루 통으로 이걸 해결하느라 보냈더니 머리가 아프다.. 서버 빌드되는 과정을 계속 계속 보는데 오류가 날때마다 인상을 찌푸리게 됐었다.. 원인을 모르니 킁... 그래도 잘 해결돼서 기분이 넘나 좋다.

오늘부터는 기술관련 글을 계속 쓸 생각이다.
개발자는 기억을 믿지 말고 기록을 믿으라는 문구를 보았는데, 그게 정말로 맞는 말인 것 같아서다.
몇몇 회사들도 잘 관리된 깃허브나 기술블로그를 원하는 곳들이 종종 있었기 때문이다.
